<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Example projects and demos: minicli</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="airoha.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Example projects and demos
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="modules.html"><span>Project&#160;user's&#160;guide</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__mt7686__hdk__apps__minicli.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">minicli<div class="ingroups"><a class="el" href="group__mt7686__hdk.html">mt7686_hdk</a> &raquo; <a class="el" href="group__mt7686__hdk__apps.html">apps</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<dl class="section user"><dt>Overview</dt><dd><ul>
<li>Example project description<ul>
<li>This project is a reference application to create a MiniCLI task with custom defined commands.</li>
</ul>
</li>
<li>Features of the example project<ul>
<li>This project creates a CLI task and waits for the user input through a serial port.</li>
</ul>
</li>
<li>Output from the example<ul>
<li>An output log is printed on the serial port window.</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="section user"><dt>Hardware and software environment</dt><dd><ul>
<li>Supported HDK<ul>
<li>MediaTek LinkIt 7686 HDK.</li>
</ul>
</li>
<li>Environment configuration<ul>
<li>The output logs are communicated through a micro-USB cable to the PC from USB (CON5) connector on the HDK.<ul>
<li>Install the mbed serial driver according to the instructions at <a href="https://developer.mbed.org/handbook/Windows-serial-configuration">https://developer.mbed.org/handbook/Windows-serial-configuration</a>. For more information, please refer to section "Installing the LinkIt 7686
        HDK drivers on Microsoft Windows" on the "LinkIt 7686 HDK User Guide" in [sdk_root]/doc folder.</li>
<li>Use a type-A to micro-B USB cable to connect type-A USB of the PC and MK20 micro-B USB connector on the LinkIt 7686 HDK. For more information about the connector cable, please refer to <a href="https://en.wikipedia.org/wiki/USB#Mini_and_micro_connectors">https://en.wikipedia.org/wiki/USB#Mini_and_micro_connectors</a>.</li>
<li>Launch a terminal emulator program, such as Tera terminal on your PC for data logging through UART. For the installation details, please refer to section "Installing Tera terminal on Microsoft Windows" on the "Airoha IoT SDK for RTOS Get Started Guide" in [sdk_root]/doc folder.</li>
<li>COM port settings. baudrate: 115200, data bits: 8, stop bit: 1, parity: none and flow control: off.</li>
</ul>
</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="section user"><dt>Directory contents</dt><dd><ul>
<li>Source and header files<ul>
<li><b>src/main.c</b>: Main program.</li>
<li><b>src/system_mt7686.c</b>: The configuration file of the Cortex-M4 with floating point core registers and system clock</li>
<li><b>src/sys_init.c</b>: This file initializes the basic hardware environment for the system, including system clock, UART port for logging, Pinmux, cache and other necessary hardware.</li>
<li><b>src/ept_eint_var.c</b>: The EINT configuration file generated by Easy Pinmux Tool (EPT). Please do not edit the file.</li>
<li><b>src/ept_gpio_var.c</b>: The GPIO configuration file generated by Easy Pinmux Tool (EPT). Please do not edit the file.</li>
<li><b>inc/FreeRTOSConfig.h</b>: FreeRTOS feature configuration file.</li>
<li><b>inc/task_def.h</b>: Define the task stack size, queue length, project name, and priority for the application to create tasks.</li>
<li><b>inc/hal_feature_config.h</b>: MT76x7 feature configuration file.</li>
<li><b>inc/flash_map.h</b>: MT76x7 memory layout symbol file.</li>
<li><b>inc/ept_eint_drv.h</b>: The EINT configuration file generated by Easy Pinmux Tool (EPT). Please do not edit the file.</li>
<li><b>inc/ept_gpio_drv.h</b>: The GPIO configuration file generated by Easy Pinmux Tool (EPT). Please do not edit the file.</li>
<li><b>inc/sys_init.h</b>: The header file of sys_init.c.</li>
<li><b>inc/task_def.h</b>: The task configuration file.</li>
</ul>
</li>
<li>Project configuration files using GCC<ul>
<li><b>GCC/startup_mt7686.s</b>: MT76x7 startup file for GCC.</li>
<li><b>GCC/syscalls.c</b>: The minimal implementation of the system calls.</li>
<li><b>GCC/mt7686_hdk.cmm</b>: This CMM is for lakrpsur development on 7686 E2 EVB.</li>
<li><b>GCC/feature.mk</b>: Feature configuration.</li>
<li><b>GCC/Makefile</b>: Makefile.</li>
<li><b>GCC/mt7686_flash.ld</b>: Linker script.</li>
</ul>
</li>
<li>Project configuration files using IAR<ul>
<li><b>EWARM/flash.icf</b>: Linker configuration file.</li>
<li><b>EWARM/minicli.ewd</b>: Debugger settings file.</li>
<li><b>EWARM/minicli.ewp</b>: Project file.</li>
<li><b>EWARM/minicli.ewt</b>: C-STAT and C-RUN settings.</li>
<li><b>EWARM/minicli.ewd</b>: Workspace file.</li>
<li><b>EWARM/startup_mt7686.s</b>: MT7686 startup file.</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="section user"><dt>Run the demo</dt><dd><ul>
<li>Connect the board to the PC with a serial port cable.</li>
<li>Build the example project with the command "./build.sh mt7686_hdk
    minicli" from the SDK root folder and download the binary file to LinkIt 7686 development board.</li>
<li>After reboot the development board, when a login prompt is shown as below, provide 'admin' as user id and press enter: <pre class="fragment">MediaTek IoT Solution
login:
</pre></li>
<li>Then provide '123456' as password. It will fail because the CLI engine is looking for 'password' as the credential. Try again with 'admin' and 'password' to get to command line. <pre class="fragment">MediaTek IoT Solution
login: admin
password: *****
login failed
login: admin
password: ********
</pre></li>
<li><p class="startli">'$' shows on the screen. Now CLI task waits for the user input to query the CLI commands, parameters, or execute commands.</p>
<p class="startli">For example, to know what are the supported commands, use '?' and press enter: </p><pre class="fragment">$ ?
hello  - hello world
echo   - show the supplied params
cal    - do simple math
line   - pass a line to cli engine
tokens - pass tokens to cli engine
count  - counter operations
logout - end this session
$
</pre></li>
<li>Now try entering 'hello' (an example command in this project), 'Hello world' is printed on screen. <pre class="fragment">$ hello
Hello world
</pre></li>
<li>Try the sample calculating command 'cal'. <pre class="fragment">$ cal 1 + 2
outcome 3
</pre></li>
<li>One can use the CLI Engine to parse and execute an input string. Possible user scenarios are when storing history commands or adding the support of stored scripts. In this example, we can see that CLI engine can process input string 'cal 2 + 3' as a complete string token, instead of separated four tokens: 'cal', '2', '+', and '3'. To ensure a string is considered one complete token, use single quotes or double quotes to enclose it. <pre class="fragment">$ line 'cal 2 + 3'
outcome 5
</pre></li>
<li>The CLI Engine also provides API to support processing tokens. Same as the last example 'cal 2 + 3', there is no enclosing single quote in this example. The command 'tokens' takes the extra four tokens and feeds them back to CLI engine for further processing. <pre class="fragment">$ tokens cal 3 + 4
outcome 7
</pre></li>
<li>When commands grow more and more, it is desired to fold sub-commands in a parent command. In this example, the command 'count' has three sub-commands. When executed without paramters, the CLI engine detects 'count' needs more options but none was given. The CLI engine shows the description automatically. <pre class="fragment">$ count
incomplete command, more options:
show   - show counter
tick   - increase counter
reset  - reset counter
</pre></li>
<li>User can actively query the option, too. <pre class="fragment">$ count ?
show   - show counter
tick   - increase counter
reset  - reset counter
</pre></li>
<li>The CLI engine provides a built-in command '??', double question marks, for querying the whole command list, including the sub-commands. <pre class="fragment">$ ??
hello - hello world
echo - show the supplied params
cal - do simple math
line - pass a line to cli engine
tokens - pass tokens to cli engine
count - counter operations
count show - show counter
count tick - increase counter
count reset - reset counter
logout - end this session
</pre></li>
<li>Now try the 'count' command family, which includes an increment command, a show command, and a reset command. <pre class="fragment">$ count show
0

$ count tick

$ count show
1

$ count reset

$ count show
0
</pre></li>
<li>When the things were done, the user can logout the CLI task using the user-implemented 'logout' command. And of course can login again and so on. <pre class="fragment">$ logout
logout

MediaTek IoT Solution
login: admin
password: ********
$ logout
logout
MediaTek IoT Solution
login:
</pre></li>
<li>Now, it is time to try to add your own command.</li>
<li>Recapping the full demo, the one-piece log is listed here. <pre class="fragment">MediaTek IoT Solution
login: admin
password: *****
login failed
login: admin
password: ********
$ ?
hello  - hello world
echo   - show the supplied params
cal    - do simple math
line   - pass a line to cli engine
tokens - pass tokens to cli engine
count  - counter operations
logout - end this session
$ hello
Hello world
$ cal 1 + 2
outcome 3
$ line 'cal 2 + 3'
beware of stack overflow because this can be abused recursively
outcome 5
$ tokens cal 3 + 4
beware of stack overflow because this can be abused recursively
outcome 7
$ count
incomplete command, more options:
show   - show counter
tick   - increase counter
reset  - reset counter
$ count ?
show   - show counter
tick   - increase counter
reset  - reset counter
$ ??
hello - hello world
echo - show the supplied params
cal - do simple math
line - pass a line to cli engine
tokens - pass tokens to cli engine
count - counter operations
count show - show counter
count tick - increase counter
count reset - reset counter
logout - end this session
$ count show
0
$ count tick
$ count show
1
$ count reset
$ count show
0
$ logout
logout
MediaTek IoT Solution
login: admin
password: ********
$ logout
logout
MediaTek IoT Solution
login:</pre></li>
</ul>
</dd></dl>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon May 21 2018 17:29:31 for Example projects and demos by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
